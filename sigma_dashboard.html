<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" type="image/png" href="logo_sigma.png"
        onerror="this.onerror=null; this.src='https://placehold.co/16x16/800020/ffffff?text=S'">
    <title>SIGMA - Gestão & Comando</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>

    <img src="cbmrr.png" id="logo-cbmrr-pdf" crossorigin="anonymous"
        style="position: absolute; left: -9999px; top: -9999px; width: 100px;">

    <link rel="stylesheet" href="css/dashboard.css">
</head>

<body>

    <div id="mobile-overlay" class="sidebar-overlay" onclick="closeMenuMobile()"></div>

    <header class="main-header">
        <div class="header-left">
            <button id="menu-btn" onclick="toggleMenuMobile()">
                <i class="fa-solid fa-bars-staggered"></i>
            </button>
            <img src="logo_sigma.png" alt="Logo SIGMA" class="header-icon desktop-only">
        </div>

        <div class="header-title-desktop">
            <span class="text-white">SISTEMA INTEGRADO DE GESTÃO DE MATERIAIS</span>
            <span style="color: #ff9999; font-weight: 800;">CBMRR</span>
        </div>

        <div class="header-center-mobile">
            <img src="logo_sigma.png" alt="Logo SIGMA" class="header-icon-mobile">
            <span class="text-white">SIGMA</span>
        </div>

        <div class="user-profile-header" onclick="toggleProfileDropdown(event)">
            <div class="user-info-text desktop-only">
                <strong id="user-name-top" style="font-size: 0.9rem; letter-spacing: 0.3px;">Carregando...</strong>

                <small id="user-role-top" style="
            display: block;
            text-transform: uppercase; 
            color: rgba(255,255,255,0.85); 
            font-size: 0.65rem; 
            font-weight: 800; 
            letter-spacing: 0.8px;
            margin-top: 2px;">
                    Acesso
                </small>
            </div>

            <div class="user-avatar-wrapper">
                <img src="https://placehold.co/40x40/800020/fff?text=..." id="user-avatar-top" class="user-avatar-img"
                    onerror="this.src='https://ui-avatars.com/api/?name=User&background=800020&color=fff'">
                <i class="fas fa-chevron-down desktop-only"
                    style="font-size: 0.6rem; color: rgba(255,255,255,0.7);"></i>
            </div>

            <div class="profile-dropdown" id="profileDropdown">
                <div class="dropdown-header">
                    <i class="fas fa-id-card"></i> Detalhes da Conta
                </div>

                <div class="dropdown-item">
                    <i class="fas fa-university"></i>
                    <div>
                        <span class="label">Unidade</span>
                        <span id="user-unit-top" class="value">Sincronizando...</span>
                    </div>
                </div>

                <div class="dropdown-item">
                    <i class="fas fa-shield-alt"></i>
                    <div>
                        <span class="label">Permissão Atual</span>
                        <span id="user-access-top" class="value">Aguardando...</span>
                    </div>
                </div>

                <a href="javascript:void(0)" onclick="logout()" class="dropdown-item logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <strong>Sair do Sistema</strong>
                </a>
            </div>
        </div>
    </header>

    <div id="mobile-overlay" onclick="toggleMenuMobile(true)"></div>

    <div class="sidebar" id="main-sidebar">

        <a onclick="switchView('dashboard'); toggleMenuMobile(true)" id="link-dashboard" class="active">
            <i class="fas fa-chart-line"></i>
            <span>Dashboard</span>
        </a>

        <a onclick="switchView('my-history'); toggleMenuMobile(true)" id="link-my-history">
            <i class="fas fa-history"></i>
            <span>Atividades</span>
        </a>

        <div class="sigma-v3-menu-group">
            <a href="javascript:void(0)" class="sigma-v3-dropdown-btn" onclick="toggleSubMenu('submenu-cautelas', this)"
                id="link-cautelas-group">
                <i class="fas fa-inbox"></i>
                <span>Cautelas</span>
                <i class="fas fa-chevron-down arrow-icon"></i>
            </a>
            <div id="submenu-cautelas" class="sigma-v3-submenu" style="display: none;">
                <a onclick="switchView('cautelas-nova'); toggleMenuMobile(true)" id="link-cautelas-nova">
                    <i class="fas fa-plus-circle"></i> <span>Nova</span>
                </a>
                <a onclick="switchView('cautelas-ativas'); toggleMenuMobile(true)" id="link-cautelas-ativas">
                    <i class="fas fa-file-signature"></i> <span>Ativas</span>
                </a>
                <a onclick="switchView('cautelas-receber'); toggleMenuMobile(true)" id="link-cautelas-receber">
                    <i class="fas fa-file-import"></i> <span>Receber</span>
                </a>
                <a onclick="switchView('cautelas-historico'); toggleMenuMobile(true)" id="link-cautelas-historico">
                    <i class="fas fa-history"></i> <span>Histórico</span>
                </a>
            </div>
        </div>

        <a onclick="switchView('almoxarifado'); toggleMenuMobile(true)" id="link-almoxarifado"
            class="restricted-admin-only">
            <i class="fas fa-warehouse"></i>
            <span>Estoque</span>
        </a>

        <hr style="border: 0.5px solid rgba(255,255,255,0.1); margin: 10px 15px;" class="restricted-admin-only">

        <a onclick="switchView('unidades'); toggleMenuMobile(true)" id="link-unidades" class="restricted-admin-only">
            <i class="fas fa-building"></i>
            <span>Unidades</span>
        </a>

        <a onclick="switchView('postos'); toggleMenuMobile(true)" id="link-postos" class="restricted-admin-only">
            <i class="fa-solid fa-flag"></i>
            <span>Postos</span>
        </a>

        <a onclick="switchView('vtr-bases'); toggleMenuMobile(true)" id="link-vtr-bases" class="restricted-admin-only">
            <i class="fas fa-car"></i>
            <span>Viaturas</span>
        </a>

        <a onclick="switchView('usuarios'); toggleMenuMobile(true)" id="link-usuarios" class="restricted-admin-only">
            <i class="fas fa-users"></i>
            <span>Usuários</span>
        </a>

        <a onclick="switchView('listas'); toggleMenuMobile(true)" id="link-listas" class="restricted-admin-only">
            <i class="fas fa-clipboard-list"></i>
            <span>Listas</span>
        </a>
    </div>

    <div class="content">

        <div id="view-dashboard" class="view-section">
            <div class="v3-dashboard-header">
                <div class="v3-greeting-compact">
                    <img id="greeting-photo" src="https://ui-avatars.com/api/?background=800020&color=fff&bold=true"
                        alt="User">
                    <div class="v3-user-info">
                        <h2 id="greeting-text">Carregando...</h2>
                        <span id="greeting-name">...</span>
                        <small id="current-date">...</small>
                    </div>
                </div>

                <div class="v3-action-hub">
                    <div id="fab-options" class="v3-fab-options">
                        <button class="btn-v3-action btn-v3-vtr" onclick="prepararChecklistVtr()">
                            <i class="fas fa-car"></i> <span>Checklist VTR</span>
                        </button>
                        <button class="btn-v3-action btn-v3-conf" onclick="openNewConferenceModal()">
                            <i class="fas fa-clipboard-list"></i> <span>Conferência</span>
                        </button>
                    </div>
                    <button class="v3-fab-main" onclick="toggleFabMenu()">
                        <i class="fas fa-plus" id="fab-icon"></i>
                    </button>
                </div>
            </div>

            <div id="resume-container"></div>

            <div id="dashboard-content-by-role" class="dashboard-master-detail-container">

                <aside class="dashboard-master-column">
                    <div id="admin-gestor-cards-container" style="display: none;">
                        <div class="sigma-v3-clean-wrapper" style="margin-top: 10px;">
                            <div id="loading-message-dashboard"
                                style="display:none; padding: 20px; color: #64748b; font-size: 0.9em; font-weight: 600;">
                                <i class="fas fa-sync fa-spin"></i> Sincronizando pendências...
                            </div>
                            <div id="cards-container" class="cards-grid"></div>
                        </div>
                    </div>

                    <div id="operacional-cards-container"></div>
                </aside>

                <main class="dashboard-detail-column">
                    <div id="detail-placeholder" class="sigma-v3-empty-state">
                        <i class="fas fa-clipboard-check"></i>
                        <p>Selecione uma viatura para gerenciar as pendências</p>
                    </div>

                    <div id="ca-table-wrapper" class="sigma-v3-details-wrapper" style="display: none;">
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                            <h2 id="table-title" style="margin:0; color:#800020; font-size: 1.4em;"></h2>
                            <button onclick="fecharTabela()" class="btn-modern-action btn-delete"
                                style="height: 35px; padding: 0 20px;">Fechar Detalhes</button>
                        </div>
                        <div id="sigma-v3-dynamic-grid" class="sigma-v3-details-grid"></div>
                        <div id="no-issues-msg"
                            style="display:none; padding:40px; text-align:center; color:#1b8a3e; font-weight: bold;">
                            <i class="fas fa-check-double fa-2x"></i><br>Nenhuma pendência ativa nesta viatura.
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <div id="view-my-history" class="view-section">
            <div class="sigma-v3-clean-wrapper">

                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px;">
                    <div class="sigma-v3-title-label" style="margin-bottom: 0;">
                        <i class="fas fa-history" style="color: #800020;"></i>
                        <span id="atividades-main-title">Atividades</span>
                    </div>

                    <div id="atividades-tabs-container" style="display: none; gap: 5px;">
                        <button onclick="switchAtividadesTab('pessoal')" id="tab-pessoal"
                            class="sigma-v3-tab active">Minhas</button>
                        <button onclick="switchAtividadesTab('unidade')" id="tab-unidade"
                            class="sigma-v3-tab">Unidade</button>
                    </div>
                </div>

                <div id="content-pessoal" class="atividades-tab-content">
                    <div class="sigma-v3-filter-row">
                        <div class="sigma-v3-input-group">
                            <label><i class="fas fa-calendar-alt"></i> Data Inicial</label>
                            <input type="date" id="my-hist-start" class="sigma-v3-date-input">
                        </div>
                        <div class="sigma-v3-input-group">
                            <label><i class="fas fa-calendar-check"></i> Data Final</label>
                            <input type="date" id="my-hist-end" class="sigma-v3-date-input">
                        </div>
                        <button onclick="loadMyHistory()" class="btn-modern-filter">
                            <i class="fas fa-filter"></i> <span>Filtrar</span>
                        </button>
                    </div>
                    <div id="my-history-list" class="sigma-v3-timeline"></div>
                </div>

                <div id="content-unidade" class="atividades-tab-content" style="display: none;">
                    <div class="sigma-v3-filter-row secondary-bg">
                        <div class="sigma-v3-input-group flex-2">
                            <label><i class="fas fa-user"></i> Militar</label>
                            <select id="glob-hist-user" class="sigma-v3-select"></select>
                        </div>
                        <div class="sigma-v3-input-group flex-2">
                            <label><i class="fas fa-truck-pickup"></i> Localização</label>
                            <select id="glob-hist-local" class="sigma-v3-select"></select>
                        </div>
                        <div class="sigma-v3-input-group">
                            <label>Início</label>
                            <input type="date" id="glob-hist-start" class="sigma-v3-date-input">
                        </div>
                        <div class="sigma-v3-input-group">
                            <label>Fim</label>
                            <input type="date" id="glob-hist-end" class="sigma-v3-date-input">
                        </div>
                        <button onclick="loadGlobalHistory()" class="btn-modern-filter dark-btn">
                            <i class="fas fa-filter"></i> <span>Filtrar</span>
                        </button>
                    </div>
                    <div id="global-history-list" class="sigma-v3-timeline"></div>
                </div>

            </div>
        </div>

        <div id="view-usuarios" class="view-section">
            <div class="sigma-v3-title-label" style="margin-bottom: 20px;">
                <i class="fas fa-users-cog" style="color: #800020;"></i>
                <span>GESTÃO DE USUÁRIOS E MILITARES</span>
            </div>

            <div class="header-container"
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                <div>
                    <p style="color: #64748b; font-size: 0.85em; font-weight: 600; margin: 0;">
                        Usuários <i class="fas fa-chevron-right" style="font-size: 0.7em; margin: 0 5px;"></i> Gestão de
                        Efetivo
                    </p>
                </div>

                <div style="display: flex; gap: 12px; align-items: center;">
                    <div
                        style="background: #f1f5f9; padding: 4px; border-radius: 10px; display: flex; gap: 4px; border: 1px solid #e2e8f0;">
                        <button onclick="mudarModoVisao('grid')" id="btn-visao-grid" class="btn-toggle-v3 active"
                            title="Ver em Cards">
                            <i class="fas fa-th-large"></i>
                        </button>
                        <button onclick="mudarModoVisao('lista')" id="btn-visao-lista" class="btn-toggle-v3"
                            title="Ver em Lista">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>

                    <button class="sigma-v3-tab active" onclick="abrirFormularioUsuario()"
                        style="background: #800020; color: white; border: none; height: 42px; padding: 0 20px; border-radius: 10px;">
                        <i class="fas fa-user-plus"></i> NOVO MILITAR
                    </button>
                </div>
            </div>

            <div class="alphabet-filter"
                style="display: flex; justify-content: center; gap: 4px; margin-bottom: 20px; flex-wrap: wrap; padding: 0 10px;">
            </div>

            <div class="sigma-v3-clean-card" style="margin-bottom: 25px; padding: 20px;">
                <div style="display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-end;">
                    <div class="filter-item" style="flex: 1; min-width: 280px;">
                        <label
                            style="display: block; font-weight: 800; font-size: 0.7em; color: #64748b; text-transform: uppercase; margin-bottom: 8px;">
                            <i class="fas fa-search"></i> Pesquisa Rápida no Efetivo
                        </label>
                        <div style="position: relative;">
                            <i class="fas fa-search"
                                style="position: absolute; left: 15px; top: 12px; color: #94a3b8;"></i>
                            <input type="text" id="user-search-input" oninput="filtrarUsuariosCards()"
                                placeholder="Buscar por nome, posto ou unidade..."
                                style="width: 100%; padding: 10px 10px 10px 40px; border-radius: 10px; border: 1px solid #e2e8f0; background: #f8fafc; outline: none; box-sizing: border-box; font-size: 0.9em;">
                        </div>
                    </div>
                </div>
            </div>

            <div id="users-render-container" class="v3-vtr-grid">
            </div>
        </div>

        <div id="view-unidades" class="view-section">
            <div class="sigma-v3-title-label" style="margin-bottom: 20px;">
                <i class="fas fa-sitemap" style="color: #800020;"></i>
                <span>GESTÃO DE UNIDADES</span>
            </div>

            <div class="header-container"
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                <div>
                    <p style="color: #64748b; font-size: 0.85em; font-weight: 600; margin: 0;">
                        Unidades <i class="fas fa-chevron-right" style="font-size: 0.7em; margin: 0 5px;"></i> Gestão de
                        Unidades
                    </p>
                </div>
                <div class="global-actions">
                    <button class="sigma-v3-tab active" onclick="abrirFormularioUnidade()"
                        style="background: #800020; color: white; border: none; height: 42px; padding: 0 20px;">
                        <i class="fas fa-plus-circle"></i> NOVA UNIDADE
                    </button>
                </div>
            </div>

            <div class="sigma-v3-clean-card" style="margin-bottom: 25px; padding: 20px;">
                <div style="display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-end;">
                    <div class="filter-item" style="flex: 1; min-width: 280px;">
                        <label
                            style="display: block; font-weight: 800; font-size: 0.7em; color: #64748b; text-transform: uppercase; margin-bottom: 8px;">
                            <i class="fas fa-search"></i> Localizar Sigla, Nome ou Comandante
                        </label>
                        <div style="position: relative;">
                            <i class="fas fa-search"
                                style="position: absolute; left: 15px; top: 12px; color: #94a3b8;"></i>
                            <input type="text" id="input-busca-unidade" onkeyup="filtrarUnidadesCards()"
                                placeholder="Ex: 1º BBM, CCI, COMANDO..."
                                style="width: 100%; padding: 10px 10px 10px 40px; border-radius: 10px; border: 1px solid #e2e8f0; background: #f8fafc; outline: none; box-sizing: border-box; font-size: 0.9em;">
                        </div>
                    </div>
                </div>
            </div>

            <div id="units-cards-container" class="v3-vtr-grid">
            </div>
        </div>

        <div id="view-postos" class="view-section">
            <div class="sigma-v3-title-label" style="margin-bottom: 20px;">
                <i class="fas fa-map-marked-alt" style="color: #800020;"></i>
                <span>Gestão de Postos e Bases</span>
            </div>

            <div class="header-container"
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                <div>
                    <p style="color: #64748b; font-size: 0.85em; font-weight: 600; margin: 0;">
                        Postos <i class="fas fa-chevron-right" style="font-size: 0.7em; margin: 0 5px;"></i> Gestão de
                        Postos e Bases
                    </p>
                </div>
                <div class="global-actions">
                    <button id="btn-toggle-posto" class="sigma-v3-tab active" onclick="abrirFormularioPosto()"
                        style="background: #800020; color: white; border: none;">
                        <i class="fas fa-plus-circle"></i> Novo Posto
                    </button>
                </div>
            </div>

            <div class="sigma-v3-clean-card" style="margin-bottom: 25px; padding: 20px;">
                <div style="display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-end;">
                    <div class="filter-item" style="flex: 1; min-width: 280px;">
                        <label
                            style="display: block; font-weight: 800; font-size: 0.7em; color: #64748b; text-transform: uppercase; margin-bottom: 8px;">
                            <i class="fas fa-search"></i> Localizar Posto ou Endereço
                        </label>
                        <div style="position: relative;">
                            <i class="fas fa-search"
                                style="position: absolute; left: 15px; top: 12px; color: #94a3b8;"></i>
                            <input type="text" id="input-busca-posto" onkeyup="filtrarPostosCards()"
                                placeholder="Ex: Prontidão Alfa, Guarita, Endereço..."
                                style="width: 100%; padding: 10px 10px 10px 40px; border-radius: 10px; border: 1px solid #e2e8f0; background: #f8fafc; font-size: 0.9em; box-sizing: border-box; outline: none;">
                        </div>
                    </div>
                </div>
            </div>

            <div id="postos-cards-container" class="cards-grid">
            </div>
        </div>

        <div id="view-vtr-bases" class="view-section">
            <div class="sigma-v3-title-label" style="margin-bottom: 20px;">
                <i class="fas fa-car" style="color: #2c7399;"></i>
                <span>Gestão de Viaturas</span>
            </div>

            <div class="header-container"
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                <p style="color: #64748b; font-size: 0.85em; font-weight: 600; margin: 0;">
                    Viaturas <i class="fas fa-chevron-right" style="font-size: 0.7em; margin: 0 5px;"></i> Gestão de
                    Viaturas
                </p>
                <div class="global-actions">
                    <button id="btn-toggle-vtr-base" class="sigma-v3-tab active" onclick="abrirFormularioViatura()"
                        style="background: #2c7399; color: white; border: none;">
                        <i class="fas fa-plus-circle"></i> Nova Viatura
                    </button>
                </div>
            </div>

            <div class="sigma-v3-clean-card" style="margin-bottom: 25px; padding: 20px;">
                <div
                    style="display: flex; gap: 20px; flex-wrap: wrap; align-items: center; justify-content: space-between;">

                    <div class="filter-item" style="flex: 1; min-width: 280px;">
                        <label
                            style="display: block; font-weight: 800; font-size: 0.7em; color: #64748b; text-transform: uppercase; margin-bottom: 8px;">Localizar
                            Prefixo ou Placa</label>
                        <div style="position: relative;">
                            <i class="fas fa-search"
                                style="position: absolute; left: 15px; top: 12px; color: #94a3b8;"></i>
                            <input type="text" id="input-busca-vtr" onkeyup="filtrarViaturasCards()"
                                placeholder="Ex: ABT-10, ABS-05..."
                                style="width: 100%; padding: 10px 10px 10px 40px; border-radius: 10px; border: 1px solid #e2e8f0; background: #f8fafc; outline: none; box-sizing: border-box;">
                        </div>
                    </div>

                    <div class="filter-item" style="width: 200px;">
                        <label
                            style="display: block; font-weight: 800; font-size: 0.7em; color: #64748b; text-transform: uppercase; margin-bottom: 8px;">Status
                            Operativo</label>
                        <select id="filtro-vtr-status" onchange="filtrarViaturasCards()"
                            style="width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #e2e8f0; background: #f8fafc; outline: none; font-weight: 600; color: #475569; height: 42px;">
                            <option value="todos">TODOS OS ATIVOS</option>
                            <option value="ativo">PRONTO (OPERATIVO)</option>
                            <option value="manutencao">BAIXADO (MANUTENÇÃO)</option>
                            <option value="reserva">RESERVA</option>
                        </select>
                    </div>

                </div>
            </div>

            <div id="vtr-bases-cards-container" class="v3-vtr-grid">
            </div>
        </div>

        <div id="view-almoxarifado" class="view-section">
            <div class="sigma-v3-title-label" style="margin-bottom: 20px;">
                <i class="fas fa-warehouse" style="color: #800020;"></i>
                <span>Almoxarifado Central</span>
            </div>

            <div class="header-container"
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                <div>
                    <p id="almox-breadcrumb" style="color: #64748b; font-size: 0.85em; font-weight: 600; margin: 0;">
                        Logística <i class="fas fa-chevron-right" style="font-size: 0.7em; margin: 0 5px;"></i>
                        Inventário Geral
                    </p>
                </div>
                <div class="global-actions" style="display: flex; gap: 10px;">
                    <button id="btn-novo-cadastro-global" class="sigma-v3-tab active"
                        onclick="abrirModalCadastroGlobal()" style="display: none; background: #800020; color: white;">
                        <i class="fas fa-plus-circle"></i> Novo Cadastro
                    </button>
                    <button class="sigma-v3-tab" onclick="imprimirInventario()"
                        style="background: white; border: 1px solid #e2e8f0; color: #475569;">
                        <i class="fas fa-print"></i> Relatório PDF
                    </button>
                </div>
            </div>

            <div class="sigma-v3-clean-card" style="margin-bottom: 25px; padding: 20px;">
                <div id="almox-filtros-container"
                    style="display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-end;">

                    <div class="filter-item" style="flex: 2; min-width: 280px;">
                        <label
                            style="display: block; font-weight: 800; font-size: 0.7em; color: #64748b; text-transform: uppercase; margin-bottom: 8px;">
                            <i class="fas fa-search"></i> Pesquisar Material
                        </label>
                        <div class="custom-input-group" style="position: relative;">
                            <i class="fas fa-search"
                                style="position: absolute; left: 15px; top: 12px; color: #94a3b8;"></i>
                            <input type="text" id="almox-search" placeholder="Ex: Mangueira, EPR, Lanterna..."
                                oninput="filtrarAlmoxarifado()"
                                style="width: 100%; padding: 10px 10px 10px 40px; border-radius: 10px; border: 1px solid #e2e8f0; background: #f8fafc; font-size: 0.9em; box-sizing: border-box;">
                        </div>
                    </div>

                    <div class="filter-item" style="flex: 1; min-width: 220px;">
                        <label
                            style="display: block; font-weight: 800; font-size: 0.7em; color: #64748b; text-transform: uppercase; margin-bottom: 8px;">
                            <i class="fas fa-filter"></i> Categoria
                        </label>
                        <select id="almox-cat-filter" onchange="filtrarAlmoxarifado()"
                            style="width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #e2e8f0; background: #f8fafc; font-size: 0.9em; color: #475569; height: 41px; box-sizing: border-box;">
                            <option value="">Todas as Categorias</option>
                            <option value="EPI">EPI</option>
                            <option value="ELETRÔNICO">ELETRÔNICO</option>
                            <option value="FERRAMENTA">FERRAMENTA</option>
                            <option value="ACESSÓRIO">ACESSÓRIO</option>
                            <option value="EQUIPAMENTO">EQUIPAMENTO</option>
                            <option value="COMUNICAÇÃO">COMUNICAÇÃO</option>
                        </select>
                    </div>

                </div>
            </div>

            <div id="almox-main-display" class="sigma-v3-clean-card">

                <div id="container-tabela-principal" class="table-responsive">
                    <table class="sigma-v3-table" id="almox-table">
                        <thead>
                            <tr>
                                <th>Material</th>
                                <th style="text-align: center;">Total</th>
                                <th style="text-align: center;">Em Uso</th>
                                <th style="text-align: center;">Pendente</th>
                                <th style="text-align: center;">Disponível</th>
                                <th style="text-align: center;">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="almox-body">
                            <tr>
                                <td colspan="6" style="text-align:center; padding:60px; color:#64748b;">
                                    <i class="fas fa-sync fa-spin fa-2x"
                                        style="opacity:0.3; margin-bottom:15px; display:block;"></i>
                                    <span style="font-weight:600;">Sincronizando Banco de Dados...</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="almox-rastreio-wrapper" style="display: none; animation: fadeIn 0.3s ease;">
                    <div
                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding-bottom:15px; border-bottom: 2px solid #f1f5f9;">
                        <div>
                            <h3 id="rastreio-title" style="margin:0; color:#800020; font-size: 1.1em;">Rastreio de
                                Localização</h3>
                            <small style="color: #94a3b8;">Detalhamento por unidade e carga</small>
                        </div>
                        <button onclick="carregarAlmoxarifadoUI()" class="sigma-v3-tab" style="background: #f1f5f9;">
                            <i class="fas fa-times"></i> Fechar
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="sigma-v3-table">
                            <thead id="almox-rastreio-thead">
                                <tr>
                                    <th>Localização</th>
                                    <th style="text-align:center;">Total</th>
                                    <th style="text-align:center;">Disponível</th>
                                    <th style="text-align:center;">Status/Tomb</th>
                                    <th style="text-align:right;">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="almox-rastreio-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-cautelas" class="view-section">
            <div class="sigma-v3-clean-wrapper">
                <div id="cautelas-content"></div>
            </div>
        </div>

        <div id="menu-editor-listas" class="view-section">
            <div class="sigma-v3-title-label" style="margin-bottom: 20px;">
                <i class="fas fa-clipboard-list" style="color: #2c7399;"></i>
                <span>GESTÃO DE LISTAS DE CONFERÊNCIA</span>
            </div>

            <div class="header-container"
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                <div>
                    <p style="color: #64748b; font-size: 0.85em; font-weight: 600; margin: 0;">
                        Listas <i class="fas fa-chevron-right" style="font-size: 0.7em; margin: 0 5px;"></i> Gestão de
                        Listas
                    </p>
                </div>
                <div class="global-actions">
                    <button class="sigma-v3-tab active" onclick="abrirFormularioLista()"
                        style="background: #2c7399; color: white; border: none; height: 42px; padding: 0 20px;">
                        <i class="fas fa-plus-circle"></i> NOVA LISTA
                    </button>
                </div>
            </div>

            <div class="sigma-v3-clean-card" style="margin-bottom: 25px; padding: 20px;">
                <div style="display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-end;">
                    <div class="filter-item" style="flex: 1; min-width: 280px;">
                        <label
                            style="display: block; font-weight: 800; font-size: 0.7em; color: #64748b; text-transform: uppercase; margin-bottom: 8px;">
                            <i class="fas fa-search"></i> Localizar Prefixo ou Posto Vinculado
                        </label>
                        <div style="position: relative;">
                            <i class="fas fa-search"
                                style="position: absolute; left: 15px; top: 12px; color: #94a3b8;"></i>
                            <input type="text" id="filter-lista-busca" onkeyup="filtrarCardsListas()"
                                placeholder="Ex: ABT-17, Pátio, Alfa..."
                                style="width: 100%; padding: 10px 10px 10px 40px; border-radius: 10px; border: 1px solid #e2e8f0; background: #f8fafc; outline: none; box-sizing: border-box; font-size: 0.9em;">
                        </div>
                    </div>
                </div>
            </div>

            <div id="container-cards-listas" class="v3-vtr-grid">
            </div>
        </div>

        <div id="view-editor-arquitetura" class="view-section" style="display:none; padding: 0 !important;">

            <div class="editor-header-sticky">
                <div class="editor-nav-bar">
                    <button onclick="fecharEditorArquitetura()" class="btn-back-editor">
                        <i class="fas fa-arrow-left"></i> Sair do Editor
                    </button>
                    <div class="editor-title-container">
                        <h2 id="edit-vtr-nome">ABT-17</h2>
                        <small id="edit-vtr-unidade">Unidade: CCI</small>
                    </div>
                    <div class="editor-actions">
                        <button onclick="confirmarPublicacaoLista()" class="btn-publish">
                            <i class="fas fa-cloud-upload-alt"></i> Publicar Alterações
                        </button>
                    </div>
                </div>

                <div class="editor-search-bar"
                    style="display: flex; align-items: center; gap: 10px; padding: 0 15px 15px 15px; box-sizing: border-box; flex-wrap: wrap;">
                    <div class="search-input-wrapper" style="position: relative; flex: 1.5; min-width: 0;">
                        <i class="fas fa-plus-circle" id="icon-plus-busca"></i>
                        <input type="text" id="input-busca-estoque" placeholder="Adicionar item..."
                            oninput="buscarItemParaAdicionar(this.value)" style="width: 100%; box-sizing: border-box;">

                        <div id="rascunho-item-novo"
                            style="display:none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #f8fafc; align-items: center; padding: 0 10px; border-radius: 6px; z-index: 5; border: 1px solid #cbd5e1; box-sizing: border-box; justify-content: space-between;">
                            <div id="texto-item-rascunho"
                                style="font-size: 0.85em; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-family: 'Inter', sans-serif;">
                            </div>
                            <button onclick="cancelarRascunho()"
                                style="background:none; border:none; color:#ef4444; cursor:pointer; font-size: 1.2em;">&times;</button>
                        </div>
                        <div id="sugestoes-estoque-editor" class="suggestions-box"></div>
                    </div>

                    <div class="target-sector-wrapper" style="flex: 1; min-width: 180px;">
                        <select id="select-setor-destino" onchange="adicionarItemRapido()"
                            style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #cbd5e1; cursor: pointer;">
                            <option value="">Selecione o Setor Destino...</option>
                        </select>
                    </div>
                </div>

                <div id="popover-qtd-editor"
                    style="display:none; position: absolute; z-index: 1001; background: white; border: 1px solid #2c7399; padding: 15px; border-radius: 8px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); width: 200px;">
                    <label
                        style="font-size: 0.75em; font-weight: bold; color: #64748b; display: block; margin-bottom: 8px;">QUANTIDADE:</label>
                    <div style="display: flex; gap: 5px;">
                        <input type="number" id="input-qtd-popover" value="1" min="1"
                            style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <button onclick="confirmarQtdPopover()"
                            style="background: #1b8a3e; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">
                            <i class="fas fa-check"></i>
                        </button>
                    </div>
                    <small id="info-max-popover"
                        style="font-size: 0.7em; color: #d32f2f; margin-top: 5px; display: block;"></small>
                </div>
            </div>

            <div class="editor-main-layout">

                <div id="setores-drag-container" class="editor-setores-grid">
                </div>

                <div id="caixa-estorno-dock" class="estorno-dock-minimized">
                    <div class="estorno-header" onclick="toggleEstornoDock()">
                        <div class="header-left">
                            <i class="fas fa-archive"></i>
                            <span>Caixa de Saída</span>
                            <span id="badge-estorno-count" class="badge-voador">0</span>
                        </div>
                        <i class="fas fa-chevron-up toggle-icon"></i>
                    </div>

                    <div id="estorno-expandable-content" class="estorno-content-wrapper">
                        <div id="lista-itens-estorno" class="estorno-body">
                            <p class="empty-estorno">Nenhum item para devolução.</p>
                        </div>
                        <div class="estorno-footer">
                            <label>Justificativa Global:</label>
                            <textarea id="justificativa-estorno-global"
                                placeholder="Descreva o motivo do estorno..."></textarea>
                            <button onclick="processarEstornoLote()" class="btn-confirm-estorno">Confirmar e Devolver ao
                                Estoque</button>
                        </div>
                    </div>
                </div>

                <button class="fab-add-setor" onclick="abrirModalNovoSetor()">
                    <i class="fas fa-folder-plus"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="app-runner-container"><iframe id="app-iframe" src=""></iframe></div>

    <div id="modal-gestao-ca" class="modal-overlay">
        <div class="modal-content">
            <button class="close-btn" onclick="document.getElementById('modal-gestao-ca').style.display='none'"><i
                    class="fas fa-times"></i></button>
            <h2>Gerenciar Pendência</h2>
            <p id="gestao-item-nome" style="color:#800020; font-weight:bold; margin-bottom:5px; padding-bottom:0;"></p>

            <input type="hidden" id="gestao-doc-id">
            <input type="hidden" id="gestao-item-id-lista">
            <input type="hidden" id="gestao-pendencia-id">
            <input type="hidden" id="gestao-item-max-qtd">

            <label>Ação do Gestor</label>
            <select id="gestao-status" onchange="toggleGestaoQtd()">
                <option value="Solucionado">Resolver Pendência</option>
                <option value="Em solução">Em solução </option>
                <option value="Cautelado">Passar para Cautela Administrativa</option>
            </select>

            <div id="div-gestao-qtd" style="display:none; margin-top: 10px;">
                <label style="color:#d90f23;">Quantidade a Resolver/Tratar:</label>
                <input type="number" id="gestao-qtd" min="1" value="1">
                <small id="gestao-qtd-info"
                    style="color:#666; font-size:0.85em; display: block; margin-top: 2px;"></small>
            </div>

            <label style="margin-top: 15px;">Anotação Técnica / Despacho (Obrigatório)</label>
            <textarea id="gestao-obs" style="min-height: 100px;"
                placeholder="Descreva a solução ou o andamento da manutenção deste item específico..."></textarea>

            <div class="modal-buttons">
                <button class="btn-modern-action btn-backup"
                    onclick="document.getElementById('modal-gestao-ca').style.display='none'">Cancelar</button>
                <button class="btn-modern-action btn-sync" onclick="salvarGestaoCa()">Salvar Ação</button>
            </div>
        </div>
    </div>

    <div id="cautelaDetailsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 700px;">
            <div
                style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-bottom: 20px;">
                <h3 style="margin: 0; color: #800020;"><i class="fas fa-clipboard-list"></i> Detalhes da Cautela <span
                        id="modal-cautela-id"></span></h3>
                <button class="close-btn" onclick="document.getElementById('cautelaDetailsModal').style.display='none'"
                    style="position:static; margin-left:15px;"><i class="fas fa-times"></i></button>
            </div>

            <div class="form-area"
                style="padding: 15px; border: none; box-shadow: none; background-color: #f9f9f9; margin-bottom: 15px; border-radius: 8px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div><label>Emitente:</label><span id="modal-emitente" class="info-value"></span></div>
                    <div><label>Destinatário:</label><span id="modal-destinatario-original" class="info-value"></span>
                    </div>
                    <div><label>Recebedor Atual:</label><span id="modal-destinatario-atual" class="info-value"></span>
                    </div>

                    <div><label>Local de Origem:</label><span id="modal-local-origem" class="info-value"></span></div>
                    <div><label>Data de Emissão:</label><span id="modal-data-emissao" class="info-value"></span></div>
                    <div><label>Status:</label><span id="modal-status-text" class="info-value"></span></div>
                </div>

                <label>Observações da Emissão:</label>
                <div id="modal-obs-emissao"
                    style="background-color: #fff; padding: 10px; border-radius: 5px; border: 1px solid #eee; min-height: 40px; font-size: 0.9em; font-style: italic; margin-bottom: 15px;">
                </div>

                <label><i class="fas fa-stream"></i> Histórico de Movimentações:</label>
                <div id="modal-historico-movimentacoes"
                    style="background-color: #fff; padding: 10px; border-radius: 5px; border: 1px solid #eee; max-height: 150px; overflow-y: auto; font-size: 0.85em;">
                    <p style="color: #999; text-align: center;">Nenhuma movimentação registrada.</p>
                </div>
            </div>

            <div
                style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 5px;">
                <h4 style="color: #800020; margin: 0;">Itens Cautelados:</h4>
                <button id="btn-reportar-problema" class="btn-modern-action"
                    style="display:none; background-color: #f57c00; font-size: 0.75em; padding: 5px 10px;"
                    onclick="iniciarFluxoSubstituicao()">
                    <i class="fas fa-exclamation-triangle"></i> Substituir/Reportar
                </button>
            </div>

            <ul id="modal-itens-cautela" class="cautela-item-list"
                style="max-height: 200px; overflow-y: auto; margin-top: 10px; padding: 0; list-style: none;"></ul>

            <div class="modal-actions" style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px;">
                <button class="btn-modern-action" id="btn-receber-cautela"
                    style="display: none; background-color: #1b8a3e;">
                    <i class="fas fa-check-circle"></i> Iniciar Recebimento
                </button>

                <button class="btn-modern-action btn-delete" id="btn-devolver-cautela" style="display: none;">
                    <i class="fas fa-undo"></i> Iniciar Devolução
                </button>

                <button class="btn-modern-action btn-sync" id="btn-confirmar-devolucao" style="display: none;">
                    <i class="fas fa-handshake"></i> Confirmar Devolução
                </button>

                <button class="modal-btn-cancel"
                    onclick="document.getElementById('cautelaDetailsModal').style.display='none'">Fechar</button>
            </div>
        </div>
    </div>

    <div id="modalReportarItem" class="modal-overlay" style="display:none; z-index: 30000;">
        <div class="modal-content" style="max-width: 600px;">
            <h3 style="color: #800020;"><i class="fas fa-exclamation-triangle"></i> Reportar Problemas nos Itens</h3>
            <p style="font-size: 0.85em; color: #666; margin-bottom: 15px;">Selecione os itens danificados e descreva o
                que houve com cada um:</p>

            <div id="lista-itens-reporte"
                style="max-height: 300px; overflow-y: auto; border: 1px solid #eee; padding: 10px; border-radius: 8px; background: #fafafa;">
            </div>

            <div class="form-group" style="margin-top: 15px; text-align: left;">
                <label style="font-weight: bold; color: #800020; font-size: 0.9em;"><i class="fas fa-user-shield"></i>
                    Enviar para análise do Gestor:</label>
                <select id="select-gestor-alvo"
                    style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #800020; background: #fff5f5; font-weight: bold; margin-top: 5px;">
                    <option value="" disabled selected>Buscando gestores da unidade...</option>
                </select>
            </div>

            <div class="modal-actions" style="margin-top: 20px;">
                <button class="btn-modern-action" style="background-color: #f57c00;" onclick="salvarRelatosMultiplos()">
                    <i class="fas fa-paper-plane"></i> Enviar Pendências ao Gestor
                </button>
                <button class="modal-btn-cancel" onclick="fecharModalReporte()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modalDecisaoGestor" class="modal-overlay" style="display:none; z-index: 30005;">
        <div class="modal-content" style="max-width: 500px; border-top: 5px solid #f57c00;">
            <h3 style="color: #800020;"><i class="fas fa-gavel"></i> Decisão do Gestor</h3>
            <p id="info-item-decisao"
                style="background: #f9f9f9; padding: 10px; border-radius: 5px; font-size: 0.9em; text-align: left; border: 1px solid #eee;">
            </p>

            <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px;">
                <button class="btn-modern-action"
                    style="background-color: #1b8a3e; justify-content: flex-start; padding: 15px; height: auto;"
                    onclick="prepararSubstituicaoFisica()">
                    <i class="fas fa-sync-alt"></i>
                    <div style="text-align: left; margin-left: 10px;">
                        <b>Substituir Material</b><br>
                        <small style="text-transform: none; font-weight: normal; opacity: 0.9;">Retira item novo do
                            estoque e recebe o danificado.</small>
                    </div>
                </button>

                <button class="btn-modern-action"
                    style="background-color: #5d6d7e; justify-content: flex-start; padding: 15px; height: auto;"
                    onclick="executarRecolhimentoApenas()">
                    <i class="fas fa-arrow-down"></i>
                    <div style="text-align: left; margin-left: 10px;">
                        <b>Apenas Recolher (Baixa)</b><br>
                        <small style="text-transform: none; font-weight: normal; opacity: 0.9;">Recebe o item danificado
                            e reduz a carga da cautela.</small>
                    </div>
                </button>

                <button class="modal-btn-cancel"
                    onclick="document.getElementById('modalDecisaoGestor').style.display='none'"
                    style="margin-top: 10px;">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modalSeletorEstoque" class="modal-overlay" style="display:none; z-index: 30006;">
        <div class="modal-content" style="max-width: 600px; border-top: 5px solid #1b8a3e;">
            <h3 style="color: #1b8a3e;"><i class="fas fa-search-location"></i> Selecionar Item de Reposição</h3>
            <p style="font-size: 0.85em; color: #666; margin-bottom: 15px;">
                Buscando itens do mesmo tipo disponíveis em todas as suas listas.
            </p>

            <div id="listaEstoqueDisponivel"
                style="display: flex; flex-direction: column; gap: 10px; max-height: 400px; overflow-y: auto; padding: 5px;">
                <div style="text-align: center; color: #999; padding: 20px;">
                    Carregando estoque disponível...
                </div>
            </div>

            <button class="modal-btn-cancel"
                onclick="document.getElementById('modalSeletorEstoque').style.display='none'"
                style="margin-top: 20px; width: 100%;">Fechar</button>
        </div>
    </div>

    <div id="modal-detalhe-carimbos" class="modal-overlay" style="display:none; z-index: 30007;">
        <div class="modal-content" style="max-width: 500px; border-top: 5px solid #5d6d7e;">
            <button class="close-btn"
                onclick="document.getElementById('modal-detalhe-carimbos').style.display='none'"><i
                    class="fas fa-times"></i></button>
            <h3 id="titulo-modal-carimbo" style="margin-bottom: 15px; color: #800020;">Detalhes do Item</h3>
            <div id="corpo-modal-carimbo" style="max-height: 400px; overflow-y: auto; padding: 5px;">
            </div>
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn-secondary"
                    onclick="document.getElementById('modal-detalhe-carimbos').style.display='none'">Fechar
                    Janela</button>
            </div>
        </div>
    </div>

    <div id="modal-cadastro-global" class="modal-overlay" style="display:none; z-index: 31000;">
        <div class="modal-content" style="max-width: 700px; border-top: 5px solid #800020;">
            <button class="close-btn" onclick="fecharModalCadastroGlobal()"><i class="fas fa-times"></i></button>

            <div
                style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
                <i class="fas fa-dna" style="font-size: 2em; color: #800020;"></i>
                <div>
                    <h2 style="margin:0; color: #800020;">Cadastro Global de Material</h2>
                    <small style="color: #666;">Defina a Família e as especificações do Modelo técnico.</small>
                </div>
            </div>

            <div class="g-cat-tabs-wrapper">
                <button class="g-cat-tab-btn active" onclick="switchTabCadastro('identificacao')">1.
                    Identificação</button>
                <button class="g-cat-tab-btn" onclick="switchTabCadastro('logistica')">2. Regras Logísticas</button>
                <button class="g-cat-tab-btn" onclick="switchTabCadastro('composicao')">3. Composição (Kit)</button>
            </div>

            <form id="form-cadastro-global">
                <div id="tab-identificacao" class="g-cat-tab-content">
                    <div class="g-cat-form-grid">
                        <div class="g-cat-field-group" style="grid-column: span 2; position: relative;">
                            <label>Família do Material (Nome Pai)</label>
                            <input type="text" id="cat-nome-pai" class="g-cat-input"
                                placeholder="Digite para buscar ou criar (Ex: MOTOSSERRA, RÁDIO...)"
                                oninput="buscarInteligenteFamilia(this.value)" autocomplete="off" required>
                            <input type="hidden" id="cat-uid-pai">

                            <div id="suggestions-familia" class="suggestions-box"
                                style="display:none; width: 100%; border-color: #800020;">
                                <ul id="list-suggestions-familia"></ul>
                            </div>
                        </div>

                        <div class="g-cat-field-group">
                            <label>Marca</label>
                            <input type="text" id="cat-marca" class="g-cat-input" placeholder="Ex: STIHL" required>
                        </div>
                        <div class="g-cat-field-group">
                            <label>Modelo / Especificidade</label>
                            <input type="text" id="cat-modelo" class="g-cat-input" placeholder="Ex: MS 123" required>
                        </div>

                        <div class="g-cat-field-group" style="grid-column: span 2;">
                            <label>Categoria</label>
                            <select id="cat-categoria" class="g-cat-input" required>
                                <option value="" disabled selected>Selecione...</option>
                                <option value="EPI">EPI</option>
                                <option value="ELETRÔNICO">ELETRÔNICO</option>
                                <option value="FERRAMENTA">FERRAMENTA</option>
                                <option value="ACESSÓRIO">ACESSÓRIO</option>
                                <option value="EQUIPAMENTO">EQUIPAMENTO</option>
                                <option value="COMUNICAÇÃO">COMUNICAÇÃO</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="tab-logistica" class="g-cat-tab-content" style="display:none;">
                    <div class="g-cat-form-grid">
                        <div class="g-cat-field-group">
                            <label>Tipo de Controle (DNA do Ativo)</label>
                            <div style="display: flex; gap: 15px; margin-top: 8px;">
                                <label style="font-weight: normal;"><input type="radio" name="cat-tipo" value="single"
                                        checked> Single (Quantidade)</label>
                                <label style="font-weight: normal;"><input type="radio" name="cat-tipo" value="multi">
                                    Multi (Tombamento)</label>
                            </div>
                        </div>
                        <div class="g-cat-field-group">
                            <label>Unidade de Medida</label>
                            <select id="cat-unidade-medida" class="g-cat-input">
                                <option value="Unidade">Unidade</option>
                                <option value="Par">Par</option>
                                <option value="Conjunto">Conjunto</option>
                                <option value="Litro">Litro</option>
                            </select>
                        </div>
                        <div class="g-cat-field-group">
                            <label>Exige Inspeção?</label>
                            <input type="checkbox" id="cat-has-inspecao" style="width: 20px;">
                        </div>
                    </div>
                </div>

                <div id="tab-composicao" class="g-cat-tab-content" style="display:none;">
                    <div class="g-cat-field-group">
                        <label>Este item é um Anfitrião de Kit?</label>
                        <div style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
                            <input type="checkbox" id="cat-is-kit" style="width: auto;"
                                onchange="document.getElementById('area-selecao-componentes').style.display = this.checked ? 'block' : 'none'">
                            <span>Sim, possui componentes internos.</span>
                        </div>
                    </div>
                    <div id="area-selecao-componentes" class="g-cat-kit-box" style="display:none;">
                        <label>Componentes Padrão do Kit:</label>
                        <div id="lista-componentes-selecionados"></div>
                        <button type="button" class="btn-secondary" style="font-size: 0.8em;">+ Adicionar do
                            Catálogo</button>
                    </div>
                </div>
            </form>

            <div class="modal-buttons" style="margin-top: 30px;">
                <button type="button" class="btn-modern-action btn-backup"
                    onclick="fecharModalCadastroGlobal()">Cancelar</button>
                <button type="button" class="btn-modern-action btn-sync" onclick="salvarCadastroGlobalHierarquico()">
                    <i class="fas fa-save"></i> Gravar no Catálogo
                </button>
            </div>
        </div>
    </div>

    <div id="modal-timeline-global" class="modal-overlay" style="display:none; z-index: 31005;">
        <div class="modal-content" style="max-width: 550px; border-top: 5px solid #fef3c7; background: #fdfdfd;">
            <button class="close-btn" onclick="document.getElementById('modal-timeline-global').style.display='none'"><i
                    class="fas fa-times"></i></button>

            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <i class="fas fa-history" style="font-size: 2em; color: #92400e;"></i>
                <div>
                    <h2 style="margin:0; color: #92400e;">Histórico de Vida</h2>
                    <small id="timeline-item-nome" style="color: #666; font-weight: bold; font-size: 1em;">Material:
                        ---</small>
                </div>
            </div>

            <div id="timeline-container"
                style="max-height: 450px; overflow-y: auto; padding: 10px; position: relative;">
            </div>

            <div style="margin-top: 20px; text-align: right; border-top: 1px solid #eee; padding-top: 15px;">
                <button class="btn-modern-action btn-secondary"
                    onclick="document.getElementById('modal-timeline-global').style.display='none'">Fechar</button>
            </div>
        </div>
    </div>

    <div id="modal-novo-setor-arquitetura" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="max-width: 400px; border-top: 6px solid #800020;">
            <button class="close-btn" onclick="fecharModalNovoSetor()"><i class="fas fa-times"></i></button>
            <h2 style="font-size: 1.2em; color: #800020; margin-bottom: 15px;">Criar Novo Setor</h2>

            <div class="form-group">
                <label>Nome do Setor:</label>
                <input type="text" id="input-nome-setor-modal" placeholder="Ex: CABINE, CARROCERIA..."
                    style="text-transform: uppercase;" onkeyup="if(event.key==='Enter') confirmarNovoSetor()">
            </div>

            <div id="area-sugestoes-setores" style="margin-top: 10px;">
                <label
                    style="font-size: 0.75em; color: #64748b; text-transform: uppercase; font-weight: bold;">Sugestões
                    de Uso Comum:</label>
                <div id="setores-tags-container" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                </div>
            </div>

            <div class="modal-buttons" style="margin-top: 25px;">
                <button class="btn-modern-action btn-backup" onclick="fecharModalNovoSetor()">Cancelar</button>
                <button class="btn-modern-action btn-sync" onclick="confirmarNovoSetor()"
                    style="background: #1b8a3e !important;">Criar Setor</button>
            </div>
        </div>
    </div>

    <div id="modal-pdf-viewer" class="sigma-v3-pdf-overlay">
        <div class="sigma-v3-pdf-modal">
            <div class="sigma-v3-pdf-header">
                <div style="display:flex; align-items:center; gap:12px;">
                    <i class="fas fa-file-pdf fa-lg"></i>
                    <div style="line-height:1;">
                        <b style="display:block; font-size:1.1em;">Visualizar Relatório</b>
                        <small id="pdf-modal-filename" style="opacity:0.8; font-size:0.75em;"></small>
                    </div>
                </div>
                <div class="sigma-v3-pdf-actions">
                    <button class="sigma-v3-pdf-btn" onclick="imprimirPdfInterno()" title="Imprimir">
                        <i class="fas fa-print"></i> <span class="hide-mobile">Imprimir</span>
                    </button>
                    <button class="sigma-v3-pdf-btn" onclick="compartilharPdfInterno()" title="Compartilhar">
                        <i class="fas fa-share-nodes"></i> <span class="hide-mobile">Compartilhar</span>
                    </button>
                    <button class="sigma-v3-pdf-btn" onclick="fecharVisualizadorPdf()"
                        style="background:#d90f23; border:none;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="sigma-v3-pdf-body">
                <iframe id="sigma-v3-pdf-frame"></iframe>
            </div>
        </div>
    </div>


    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <script src="/js/dashboard/dashboard.js"></script>
</body>

</html>
