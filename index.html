<script>
    // ... suas configurações do firebaseConfig ...
    const auth = firebase.auth();
    const db = firebase.firestore();

    function login() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const btn = document.getElementById('btn-login'); // Assumindo que seu botão tem esse ID

        btn.textContent = "Verificando...";
        btn.disabled = true;

        auth.signInWithEmailAndPassword(email, password)
            .then(async (userCredential) => {
                // Login Auth deu certo, agora verificamos o PERFIL no banco
                const uid = userCredential.user.uid;
                
                try {
                    const doc = await db.collection('usuarios').doc(uid).get();
                    
                    if (doc.exists) {
                        const dados = doc.data();
                        const role = dados.role;

                        if (role === 'admin' || role === 'gestor') {
                            // Se for Admin ou Gestor -> Vai pro Dashboard
                            window.location.href = "sigma_dashboard.html";
                        } else {
                            // Se for Operacional ou qualquer outra coisa -> Vai pro Operacional
                            window.location.href = "operacional.html";
                        }
                    } else {
                        // Usuário existe no Auth mas não no Banco (Erro de cadastro)
                        alert("Erro: Perfil de usuário não encontrado no banco de dados.");
                        btn.textContent = "Entrar";
                        btn.disabled = false;
                    }
                } catch (error) {
                    console.error("Erro ao buscar perfil:", error);
                    alert("Erro de conexão ao verificar perfil.");
                    btn.textContent = "Entrar";
                    btn.disabled = false;
                }
            })
            .catch((error) => {
                btn.textContent = "Entrar";
                btn.disabled = false;
                alert("Erro no login: " + error.message);
            });
    }
</script>
